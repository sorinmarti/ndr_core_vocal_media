{% load static %}
{% load ndr_values %}

{% config_value 'main_view' as logo_view_name %}

<!doctype html>
<html lang="en">
    <head>
        {% include 'ndr_core/base/base_header_tags.html' %}
        <link href="{% static 'ndr_core/css/ndr_core_top_fixed.css' %}" rel="stylesheet">
        {% block custom_css %}
            <!-- custom css -->
        {% endblock %}
    </head>

    <body>
        <nav class="navbar navbar-expand-md navbar-dark fixed-top accent-1-bg">
            {% block logo %}
                <a class="navbar-brand" href="/">
                    <img src="{% block logo_url %}{% static 'ndr_core/images/logo.png' %}{% endblock %}" style="height: 3em;"/>
                </a>
            {% endblock logo %}

            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav mr-auto">
                    {% for nav_item in navigation %}
                        <li class="nav-item">
                            <a class="nav-link ndr-text-fg" href="{{ nav_item.url }}">{{ nav_item.label }}</a>
                        </li>
                    {% endfor %}
                </ul>
                <button id="themeToggle" class="btn btn-sm btn-outline-light" type="button" aria-pressed="false" aria-label="Toggle dark mode">
                    <i class="fa-solid fa-adjust"></i> <span id="themeToggleText">Dark</span>
                </button>
            </div>
        </nav>

        <main role="main" class="container" style="padding-top: 7em;">
            {% block page_title %}
                <h1>{{ page.name }}</h1>
            {% endblock %}

            {% block generated_content %}
            {% endblock %}

            {% block content %}
                {{ page.template_text|safe }}
            {% endblock %}
        </main>
        {% block footer %}
            NDR core
        {% endblock %}

        <script src="{% static 'ndr_core/js/popper.min.js' %}"></script>
        <script src="{% static 'ndr_core/js/bootstrap.min.js' %}"></script>
        <script src="{% static 'fontawesome/js/all.min.js' %}"></script>

        <script>
            (function(){
                const key = "ndr-theme";
                const root = document.documentElement;
                const btn = document.getElementById("themeToggle");

                if (!btn) return;

                // init: respect saved pref; else system
                const saved = localStorage.getItem(key);
                if (saved === "dark" || saved === "light") {
                    root.setAttribute("data-theme", saved);
                }
                updateBtn();

                btn.addEventListener("click", () => {
                    const cur = root.getAttribute("data-theme");
                    const next = cur === "dark" ? "light" : "dark";
                    root.setAttribute("data-theme", next);
                    localStorage.setItem(key, next);
                    updateBtn();
                });

                function updateBtn(){
                    const t = root.getAttribute("data-theme");
                    const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
                    const isDark = t ? (t === "dark") : prefersDark;
                    btn.setAttribute("aria-pressed", isDark ? "true":"false");
                    const textEl = document.getElementById("themeToggleText");
                    if (textEl) {
                        textEl.textContent = isDark ? "Light" : "Dark";
                    }
                }
            })();
        </script>

        {% block page_js %}
        {% endblock %}

    </body>
</html>